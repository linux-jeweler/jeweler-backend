generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x", "darwin-arm64"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model LinuxDistro {
  id                String             @id @default(uuid())
  name              String
  version           String
  softwareOnSources SoftwareOnSource[]
  packageSources    PackageSource[]    @relation("LinuxDistroToPackageSource")
  users             User[]             @relation("LinuxDistroToUser")

  @@unique([name, version])
}

model PackageSource {
  id                String             @id @default(uuid())
  name              String             @unique
  image             String?
  info              String?
  description       String?
  url               String?
  trustedStatus     Boolean

  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  softwareOnSources SoftwareOnSource[]
  distros           LinuxDistro[]      @relation("LinuxDistroToPackageSource")
  software          Software[]         @relation("PackageSourceToSoftware")
}

model Software {
  id                String             @id @default(uuid())
  name              String
  version           String
  dependencies      String[]
  description       String?
  lastModified      DateTime
  license           String[]
  url               String?

  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  softwareOnSources SoftwareOnSource[]
  packageSources    PackageSource[]    @relation("PackageSourceToSoftware")
  users             User[]             @relation("SoftwareToUser")
}

model SoftwareOnSource {
  softwareId     String
  sourceId       String
  distroId       String
  installCommand String?
  instructions   String?
  downloadLink   String?
  distro         LinuxDistro   @relation(fields: [distroId], references: [id])
  software       Software      @relation(fields: [softwareId], references: [id])
  source         PackageSource @relation(fields: [sourceId], references: [id])

  @@id([softwareId, sourceId, distroId])
}

model User {
  id            String        @id @default(uuid())
  email         String        @unique
  password      String

  createdAt     DateTime      @default(now())
    updatedAt     DateTime      @updatedAt
  usedDistros   LinuxDistro[] @relation("LinuxDistroToUser")
  likedPackages Software[]    @relation("SoftwareToUser")
}
